'use strict';

/* design section funtionality */

// Variables
const cardTextSelector = document.querySelector('.preview__texts');
const cardNameSelector = document.querySelector('.preview__name');
const cardOccupationSelector = document.querySelector('.preview__occupation');
const fillNameSelector = document.querySelector('#full-name');
const fillOccupationSelector = document.querySelector('#occupation');

const decoRectangleSelector = document.querySelector('.preview__decoration-rectangle');
const socialIconSelector = document.querySelectorAll('.social-icon');
const skillIconSelector = document.querySelectorAll('.skill');
const previewSkills = document.querySelector('.preview__skills-icons');

const checkboxPaletteGreen = document.querySelector('#color-green');
const checkboxPaletteRed = document.querySelector('#color-red');
const checkboxPaletteGrey = document.querySelector('#color-grey');

const checkboxUbuntuSelector = document.querySelector('#font-ubuntu');
const checkboxComicSansSelector = document.querySelector('#font-comic-sans');
const checkboxMontserratSelector = document.querySelector('#font-montserrat');

const fakeUploadImage = document.querySelector('.fake__upload-image');
const uploadImage = document.querySelector('.upload-image');
const fakeCheckUploadImage = document.querySelector('.fake__check-upload-image');
const previewImage = document.querySelector('.preview__image');
const fr = new FileReader();

const fillEmailSelector = document.querySelector('#email');
const fillPhoneSelector = document.querySelector('#phone');
const cardSelector = document.querySelector('.preview__social-icons');
const fillLinkedInSelector = document.querySelector('#linkedin');
const fillGithubSelector = document.querySelector('#github');

const liEmail = document.querySelector('.li__email');
const liPhone = document.querySelector('.li__phone');
const liLinkedin = document.querySelector('.li__linkedin');
const liGithub = document.querySelector('.li__github');

const buttonReset = document.querySelector('.preview__reset');
const formData = document.querySelector('.main__form');
const shareButton = document.querySelector('.main__share--create');
const responseURL = document.querySelector('.main__share--generated-link');
const buttonDrop = document.querySelectorAll('.dropdown');

const boxDesign = document.querySelector('.main__design--container');
const boxFill = document.querySelector('.main__fill--container');
const boxShare = document.querySelector('.main__share--container');
const boxTwitter = document.querySelector('.main__share--generated');

const containerSkills = document.querySelector('.container--skills');
const skillContainer = document.querySelector('.preview__skills-icons');
const socialIconsContainer = document.querySelector('.preview__social-icons');

const jsonObject = {
    'palette': 1,
    'typography': 2,
    'name' : '',
    'job': '',
    'phone': '',
    'email': '',
    'linkedin': '',
    'github': '',
    'photo': '',
    'skills': []
};

'use strict';

/* dropdown */

const mainArrow = document.querySelectorAll('.main__arrow');

function dropDown(event) {
    const btnSelected = event.currentTarget;
    if (btnSelected.classList.contains('dropdown__design') === true) {
        boxDesign.classList.toggle('hidden');

        mainArrow[0].classList.toggle('fa-angle-down');
        mainArrow[0].classList.toggle('fa-angle-up');
    } else if (btnSelected.classList.contains('dropdown__fill') === true) {
        boxFill.classList.toggle('hidden');

        mainArrow[1].classList.toggle('fa-angle-down');
        mainArrow[1].classList.toggle('fa-angle-up');
    } else if (btnSelected.classList.contains('dropdown__share') === true){
        shareButton.classList.toggle('hidden');
        boxShare.classList.toggle('hidden');
        boxTwitter.classList.add('hidden');

        mainArrow[2].classList.toggle('fa-angle-down');
        mainArrow[2].classList.toggle('fa-angle-up');
    }

}
for (let i = 0; i < buttonDrop.length; i++) {
    buttonDrop[i].addEventListener('click', dropDown);
}
shareButton.addEventListener('click',showLink);

function showLink(){
    boxTwitter.classList.remove('hidden');
}

'use strict';

// When 'click'-ing checkbox, add the class corresponding to the selected palette and remove others

function choosePalette() {

    if ((this.value) === 'green-palette') {

        cardNameSelector.classList.add('preview__name--green');
        decoRectangleSelector.classList.add('preview__decoration-rectangle--green');

        localStorage.setItem('palette', '1');
        jsonObject.palette = 1;

        socialIconsContainer.classList.add('social__container--green');
        socialIconsContainer.classList.remove('social__container--red', 'social__container--grey' );

        for (let i = 0; i < skillIconSelector.length; i++) {
            skillIconSelector[i].classList.add('skill--green');
        }

        skillContainer.classList.add('icons__container--green');
        skillContainer.classList.remove('icons__container--red');
        skillContainer.classList.remove('icons__container--grey');

        cardNameSelector.classList.remove('preview__name--red', 'preview__name--grey');
        decoRectangleSelector.classList.remove('preview__decoration-rectangle--red', 'preview__decoration-rectangle--grey');
        for (let i = 0; i < socialIconSelector.length; i++) {
            socialIconSelector[i].classList.remove('social-icon--red', 'social-icon--grey');
        }
    }

    else if ((this.value) === 'red-palette') {
        cardNameSelector.classList.add('preview__name--red');
        decoRectangleSelector.classList.add('preview__decoration-rectangle--red');

        localStorage.setItem('palette', '2');
        jsonObject.palette = 2;


        socialIconsContainer.classList.add('social__container--red');
        socialIconsContainer.classList.remove('social__container--green', 'social__container--grey' );

        for (let i = 0; i < skillIconSelector.length; i++) {
            skillIconSelector[i].classList.add('skill--red');
        }

        const skillContainer = document.querySelector('.preview__skills-icons');
        skillContainer.classList.add('icons__container--red');
        skillContainer.classList.remove('icons__container--green');
        skillContainer.classList.remove('icons__container--grey');

        cardNameSelector.classList.remove('preview__name--green', 'preview__name--grey');
        decoRectangleSelector.classList.remove('preview__decoration-rectangle--green', 'preview__decoration-rectangle--grey');
        for (let i = 0; i < socialIconSelector.length; i++) {
            socialIconSelector[i].classList.remove('social-icon--green', 'social-icon--grey');
        }
    }

    else if ((this.value) === 'grey-palette') {
        cardNameSelector.classList.add('preview__name--grey');
        decoRectangleSelector.classList.add('preview__decoration-rectangle--grey');

        localStorage.setItem('palette', '3');
        jsonObject.palette = 3;

        socialIconsContainer.classList.add('social__container--grey');
        socialIconsContainer.classList.remove('social__container--red', 'social__container--green' );

        for (let i = 0; i < skillIconSelector.length; i++) {
            skillIconSelector[i].classList.add('skill--grey');
        }

        const skillContainer = document.querySelector('.preview__skills-icons');
        skillContainer.classList.add('icons__container--grey');
        skillContainer.classList.remove('icons__container--green');
        skillContainer.classList.remove('icons__container--red');

        cardNameSelector.classList.remove('preview__name--green', 'preview__name--red');
        decoRectangleSelector.classList.remove('preview__decoration-rectangle--green', 'preview__decoration-rectangle--red');
        for (let i = 0; i < socialIconSelector.length; i++) {
            socialIconSelector[i].classList.remove('social-icon--green', 'social-icon--red');
        }
    }
}

checkboxPaletteGreen.addEventListener('change', choosePalette);
checkboxPaletteRed.addEventListener('change', choosePalette);
checkboxPaletteGrey.addEventListener('change', choosePalette);

'use strict';

//When 'click'-ing checkbox, add the class corresponding to the selected typography and remove others
function chooseFont() {

    if ((this.value) === 'font-ubuntu') {
        cardTextSelector.classList.add('ubuntu');
        cardTextSelector.classList.remove('comic-sans');
        cardTextSelector.classList.remove('montserrat');

        localStorage.setItem('typography', '1');
        jsonObject.typography = 1;
    }

    else if ((this.value) === 'font-comic-sans') {
        cardTextSelector.classList.add('comic-sans');
        cardTextSelector.classList.remove('ubuntu');
        cardTextSelector.classList.remove('montserrat');

        localStorage.setItem('typography', '2');
        jsonObject.typography = 2;
    }

    else if ((this.value) === 'font-montserrat') {
        cardTextSelector.classList.add('montserrat');
        cardTextSelector.classList.remove('ubuntu');
        cardTextSelector.classList.remove('comic-sans');

        localStorage.setItem('typography', '3');
        jsonObject.typography = 3;
    }
}

checkboxUbuntuSelector.addEventListener('click', chooseFont);
checkboxComicSansSelector.addEventListener('click', chooseFont);
checkboxMontserratSelector.addEventListener('click', chooseFont);

'use strict';

// name field
fillNameSelector.addEventListener('keyup', function(e) {
    const writer = e.currentTarget;
    localStorage.setItem('name', writer.value);
    cardNameSelector.innerHTML = writer.value;
    jsonObject.name = writer.value;
});

// occupation field
fillOccupationSelector.addEventListener('keyup', function(e) {
    const writer = e.currentTarget;
    localStorage.setItem('ocuppation', writer.value);
    cardOccupationSelector.innerHTML = writer.value;
    jsonObject.job = writer.value;
});

/*profile image field*/

//fakeUploadImage activates UploadImage
const uploadClick = () => {
    uploadImage.click();
};

//clicking fakeUploadImage event listener
fakeUploadImage.addEventListener('click', uploadClick);


//UploadImage is drawn on previewImage
const writeImage = () => {
    previewImage.style.backgroundImage = `url(${fr.result})`;
    fakeCheckUploadImage.style.backgroundImage = `url(${fr.result})`;
    jsonObject.photo = fr.result;
    localStorage.setItem('image', JSON.stringify(fr.result));
};

//obtaining the image via fakeCheckUploadImage
function getImage(event) {
    const myFile = event.currentTarget.files[0];
    fr.addEventListener('load', writeImage);
    fr.readAsDataURL(myFile);
}

//Upload complete event listener
uploadImage.addEventListener('change', getImage);

/* Social icons */

// email field
fillEmailSelector.addEventListener('keyup', function(e) {
    const writer = e.currentTarget;
    if(writer.value === '') {
        liEmail.innerHTML = '';
        liEmail.classList.add('hidden');
    } else {
        liEmail.innerHTML = `<a class="socialicons-style" href="mailto:${writer.value}"><span class="far fa-envelope"></span></a>`;
        liEmail.classList.remove('hidden');
    }

    localStorage.setItem('email', writer.value);
    jsonObject.email = writer.value;
});

//phone number field
fillPhoneSelector.addEventListener('keyup', function(e) {
    const writer = e.currentTarget;
    if(writer.value === '') {
        liPhone.innerHTML = '';
        liPhone.classList.add('hidden');
    } else {
        liPhone.innerHTML = `<a class="socialicons-style" href="tel:${writer.value}"><span class="fas fa-mobile-alt"></span></a>`;
        liPhone.classList.remove('hidden');
    }
    localStorage.setItem('phone', writer.value);
    jsonObject.phone = writer.value;
});


//LinkedIn field
fillLinkedInSelector.addEventListener('keyup', function(e) {
    const writer = e.currentTarget;
    if(writer.value === '') {
        liLinkedin.innerHTML = '';
        liLinkedin.classList.add('hidden');
    } else {
        liLinkedin.innerHTML = `<a class="socialicons-style" href="https://www.linkedin.com/in/${writer.value}"><span class="fab fa-linkedin-in"></span></a>`;
        liLinkedin.classList.remove('hidden');
    }

    localStorage.setItem('linkedin', writer.value);
    jsonObject.linkedin = writer.value;
});

//Github field
fillGithubSelector.addEventListener('keyup', function(e) {
    const writer = e.currentTarget;
    if(writer.value === '') {
        liGithub.innerHTML = '';
        liGithub.classList.add('hidden');
    } else {
        liGithub.innerHTML = `<a class="socialicons-style" href="https://github.com/${writer.value}"><span class="fab fa-github-alt"></span></a>`;
        liGithub.classList.remove('hidden');
    }

    localStorage.setItem('github', writer.value);
    jsonObject.github = writer.value;
});

'use strict';

//Llamamos al API con fetch y sus respectivas promesas
fetch('https://raw.githubusercontent.com/Adalab/dorcas-s2-proyecto-data/master/skills.json')
    .then(response => response.json())
    .then(data => getSkills(data.skills));


//Pedimos toda la información de skills
//Creamos el contenido desde JS con un bucle for

function getSkills(skills){
    for (let i = 0; i < skills.length; i++){

        const skillsContainer = document.querySelector('.container--skills');

        skillsContainer.innerHTML += `<label for="skills-${skills[i]}" class="option-skills"><input class="option-button option-skills-button" id="skills-${skills[i]}" type="checkbox" value="${skills[i]}" name="skills-${skills[i]}"><p class="skills">${skills[i]}</p></label>`;
    }

    //colocamos el addEventListener aquí para que la constante optionSelector no se genere vacía por la asincronía con la API
    const optionSelector = document.querySelectorAll('.option-skills-button');

    for (let i = 0; i<optionSelector.length; i++){
        optionSelector[i].addEventListener('change', jsonCheckedItem);
    }
}


//metemos las skills que se seleccionen en el jsonObject -o las quitamos-
function jsonCheckedItem(event) {
    let previewList = document.createElement('li');
    previewList.className = `skill skill_${this.value}`;
    let previewElement = document.createTextNode(`${this.value}`);
    previewList.appendChild(previewElement);

    //Hay que crear un selector específico por clase para poder quitar la lista correspondiente en el "else", aunque previewList existe en el DOM no la acepta como "hija"
    let previewChildElement = document.querySelector(`.skill_${this.value}`);

    if(jsonObject.skills.length < 3 && event.target.checked === true) {
        previewSkills.appendChild(previewList);
        jsonObject.skills.push(event.target.value);

    } else {
        event.target.checked = false;
        if(previewChildElement){
            previewSkills.removeChild(previewChildElement);
            jsonObject.skills.splice(jsonObject.skills.indexOf(event.target.value), 1);
        }
    }
}

'use strict';

//Share functionality
shareButton.addEventListener('click', sendRequest);

function sendRequest(){
    fetch('https://us-central1-awesome-cards-cf6f0.cloudfunctions.net/card/', {
        method: 'POST',
        body: JSON.stringify(jsonObject),
        headers: {
            'content-type': 'application/json'
        },
    })
        .then(function(resp) { return resp.json(); })
        .then(function(result) {
            if(result.success === true){
                responseURL.href = result.cardURL;
                responseURL.innerHTML = result.cardURL;
                console.log('funciona');
            } else {
                responseURL.innerHTML = 'ERROR: ' + result.error;
            }
            //Twitter//

            const twitterShare = document.querySelector('.main__share--generated-twitter');

            function shareOnTwitter(){
                twitterShare.href = 'https://twitter.com/share?url=' + result.cardURL+'&text='+'¡Ey! Mira que tarjeta más molona acabo de hacer con Javascript ' + '&hashtags='+'JavaScript, Adalab';
            }

            twitterShare.addEventListener('click', shareOnTwitter);
        });
}

'use strict';

/* Reset button */

function resetForm() {

    formData.reset();
    cardNameSelector.innerHTML = 'Nombre Apellido';
    cardOccupationSelector.innerHTML = 'Front-end developer';
    previewImage.style.backgroundImage = `url(https://placehold.it/200x200/ffcc00/0000ff/?text=TEXT)`;
    fakeCheckUploadImage.style.backgroundImage = ``;
    cardSelector.innerHTML = '';
    cardNameSelector.classList.add('preview__name--green');
    decoRectangleSelector.classList.add('preview__decoration-rectangle--green');
    for (let i = 0; i < socialIconSelector.length; i++) {
        socialIconSelector[i].classList.add('social-icon--green');
    }
    for (let i = 0; i < skillIconSelector.length; i++) {
        skillIconSelector[i].classList.add('skill--green');
    }
    cardNameSelector.classList.remove('preview__name--red', 'preview__name--grey');
    decoRectangleSelector.classList.remove('preview__decoration-rectangle--red', 'preview__decoration-rectangle--grey');
    for (let i = 0; i < socialIconSelector.length; i++) {
        socialIconSelector[i].classList.remove('social-icon--red', 'social-icon--grey');
    }
    for (let i = 0; i < skillIconSelector.length; i++) {
        skillIconSelector[i].classList.remove('skill--red', 'skill--grey');
    }
    cardTextSelector.classList.add('comic-sans');
    cardTextSelector.classList.remove('ubuntu', 'montserrat');

    //Reset skills from preview and re-add event listener
    const skillsContainer = document.querySelector('.preview__skills-icons');
    skillsContainer.innerHTML = '';

    //Reset jsonObject
    jsonObject.palette = 1;
    jsonObject.typography = 2;
    jsonObject.name = '';
    jsonObject.job = '';
    jsonObject.phone = '';
    jsonObject.email = '';
    jsonObject.linkedin = '';
    jsonObject.github = '';
    jsonObject.photo = '';
    jsonObject.skills.length = 0;

    //Reset local storage
    localStorage.clear();

    //Reset link
    responseURL.href= '';

    //Hidden twitter
    boxTwitter.classList.add('hidden');

    //Reset drop-down
    boxDesign.classList.add('hidden');
    boxFill.classList.add('hidden');
    shareButton.classList.add('hidden');
    boxShare.classList.add('hidden');
}

buttonReset.addEventListener('click', resetForm);
